apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: cpiflow-training-pipeline
  annotations:
    scenarios.ai.sap.com/name: "CPIFLOW Optimizer"
    scenarios.ai.sap.com/description: "Train CPI log classifier (LR/SGD) with drift baselines & insights"
    executables.ai.sap.com/name: "cpiflow-model-training"
    executables.ai.sap.com/description: "Outputs model.pkl + metrics + insights"
    artifacts.ai.sap.com/cpiflowdataset.kind: "dataset"
    artifacts.ai.sap.com/cpiflowmodel.kind: "model"
    artifacts.ai.sap.com/prevmodel.kind: "model"
  labels:
    scenarios.ai.sap.com/id: "cpiflow-optimizer-pro"
    ai.sap.com/version: "6.0"

spec:
  imagePullSecrets:
    - name: milton-credentials

  entrypoint: mypipeline

  arguments:
    parameters:
      - name: TARGET_COLUMN
        value: "CUSTOM_STATUS"
      - name: DATA_FILE
        value: "cpi_logs_500.csv"   # will auto-detect if missing
      - name: TRAINER
        value: "LR"                 # LR or SGD
      - name: FINETUNE
        value: "0"                  # 1 to finetune if prev model provided

  templates:
    - name: mypipeline
      inputs:
        artifacts:
          - name: cpiflowdataset
            path: /app/data
          - name: prevmodel
            path: /app/prev/prev_model.pkl
            optional: true

      outputs:
        artifacts:
          - name: cpiflowmodel
            globalName: cpiflowmodel
            path: /app/model/model.pkl
            archive: { none: {} }
          - name: cpiflowmetrics
            globalName: cpiflowmetrics
            path: /app/model/metrics.json
            archive:
